class NexterBuilder{constructor(){document.body.classList.contains("post-type-nxt_builder")&&this.init()}init(){this.actionBtn=document.querySelectorAll(".page-title-action"),this.actionBtn&&this.actionBtn.forEach(a=>{a.classList.contains("nxt-btn-action")||(a.addEventListener("click",a=>{a.preventDefault();let b="action=nexter_ext_temp_popup&nexter_nonce="+nexter_admin_config.ajax_nonce;this.nxtBuilderCommon(b,!0)}),a.addEventListener("contextmenu",a=>{a.preventDefault()}),a.addEventListener("auxclick",a=>{1===a.button&&a.preventDefault()}))}),this.copySCodeBtn=document.querySelectorAll(".nxt-shortcode-copy-btn"),this.copySCodeBtn.forEach(a=>{a.addEventListener("click",a=>{a.preventDefault();let b=a.currentTarget,c=b.querySelectorAll(".nexter-input-box-button-svg"),d=b.previousElementSibling.value;if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(d);else{let a=document.createElement("textarea");a.value=d,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}setTimeout(()=>{c[0].classList.remove("active"),c[1].classList.add("active"),b.classList.add("active")},100),setTimeout(()=>{c[1].classList.remove("active"),c[0].classList.add("active"),b.classList.remove("active")},1100)})}),this.displayBtn=document.querySelectorAll(".nexter-conditions-action"),this.displayBtn.forEach(a=>{a.addEventListener("click",a=>{a.preventDefault(),this.nextOpenCondition(a,"","edit")})}),this.statusBtn=document.querySelectorAll(".status.column-status"),this.statusBtn.forEach(a=>{let b=a.querySelector(".nxt-post-status");b&&b.addEventListener("change",a=>{a.preventDefault();let b=a.currentTarget.value,c=a.currentTarget.checked?1:0,d="action=nexter_ext_status&nexter_nonce="+nexter_admin_config.ajax_nonce+"&post_id="+b+"&check="+c;this.nxtBuilderCommon(d,!1)})})}nextOpenCondition(a,b,c){let d=a.currentTarget.getAttribute("data-post"),e=a.currentTarget.getAttribute("data-type"),f=a.currentTarget.getAttribute("data-subtype"),g="";"sections"==e?g="action=nexter_ext_sections_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&post_id="+d+"&type="+c+"&"+b:"pages"==e?"page-404"==f?g="action=nexter_ext_pages_404_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&post_id="+d+"&type="+c+"&"+b:g="action=nexter_ext_pages_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&post_id="+d+"&type="+c+"&layout_type="+f+"&"+b:"code_snippet"==e&&(g="action=nexter_ext_sections_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&post_id="+d+"&type="+c+"&"+b),this.nxtBuilderCommon(g,!0)}nxtBuilderCommon(a,b){let c=document.querySelector(".nxt-ext-pop-inner");if(b&&!c&&(document.body.insertAdjacentHTML("beforeend",this.getPopupHTML()),c=document.querySelector(".nxt-ext-pop-inner")),a&&this.sendRequest(c,a),b){let a=this;document.addEventListener("click",b=>{const c=b.target,d=b.target.closest(".supports-drag-drop");if(c&&c.classList.contains("nxt-ext-setting-pop")&&!d){var e=document.querySelector(".nxt-ext-setting-pop");e&&a.closePopupAction(e)}}),document.addEventListener("keydown",a=>{if(27==a.keyCode){var b=document.querySelector(".nxt-ext-setting-pop");b&&b.remove()}})}}getPopupHTML(){return`<div class="nxt-ext-setting-pop nxt-builder-settings-popup"><div class="nxt-ext-pop-inner"><button class="ext-close-button">Ã—</button><div class="spinner"></div></div></div>`}nxt_ext_close_pop(a){var b=a.querySelector(".ext-close-button");if(b){let c=this;b.addEventListener("click",b=>{b.preventDefault(),c.closePopupAction(a)})}}sendRequest(a,b){const c=new XMLHttpRequest;c.open("POST",nexter_admin_config.ajaxurl,!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.setRequestHeader("Accept","application/json"),c.onload=()=>{if(a&&(a.querySelector(".spinner").remove(),200<=c.status&&400>c.status)){const d=JSON.parse(c.response);if(!0===d.success&&""!==d.data.content){a.insertAdjacentHTML("beforeend",d.data.content);let c=a.querySelector(".nxt-temp-layout"),f=a.querySelector(".nxt-header-type-wrap"),g=a.querySelector(".nxt-footer-type-wrap"),h=a.querySelector(".nxt-hooks-type-wrap"),i=a.querySelector(".nxt-temp-name"),j=a.querySelector(".nxt-action-back"),k=a.querySelector(".temp-next-button"),l=a.querySelector(".nxt-footer-type"),m=a.querySelector(".nxt-footer-smart-bgcolor"),n=a.querySelector(".temp-edit-btn-save"),o=a.querySelector(".nxt-addition-toggle"),p=o?o.querySelectorAll(".nxt-open"):"",q=o?o.querySelectorAll(".nxt-close"):"";h&&jQuery(".nxt-hooks-action-type").select2({dropdownCssClass:"nxt-builder-select"});let r=a.querySelector("form"),s=new FormData(r),t=new URLSearchParams;s.forEach((a,b)=>{let c=r.querySelector(`[name="${b}"]`);const d="none"!==window.getComputedStyle(c.parentElement).display;"action"!==b&&d&&t.append(b,a)});let u=t.toString();window.nxtBuilderOldData=u,n&&n.addEventListener("click",a=>{a.preventDefault();let b=a.currentTarget;b.textContent="Saving..";const c=new FormData(r);let d=new URLSearchParams,e=new URLSearchParams;c.forEach((a,b)=>{const c=r.querySelector(`[name="${b}"]`),f="none"!==window.getComputedStyle(c.parentElement).display;f&&d.append(b,a),"action"!==b&&f&&e.append(b,a)});const f=d.toString(),g=e.toString();fetch(nexter_admin_config.ajaxurl,{method:"POST",body:f,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(a=>a.json()).then(a=>{a&&a.success&&(b.textContent="Saved",window.nxtBuilderOldData=g,document.body.classList.contains("post-php")?setTimeout(()=>{b.textContent="Save"},2e3):(b.textContent="Save",location.reload()))}).catch(a=>console.error("Error:",a))}),j&&j.addEventListener("click",b=>{b.preventDefault(),a.parentElement.remove();let c=r.querySelector("[name=\"post_id\"]").value,d="action=nexter_ext_temp_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&post_id="+c;this.nxtBuilderCommon(d,!0)}),k&&k.addEventListener("click",b=>{b.preventDefault();const c=new FormData(r);let d=new URLSearchParams;c.forEach((a,b)=>{const c=r.querySelector(`[name="${b}"]`),e="none"!==window.getComputedStyle(c.parentElement).display;"action"!==b&&e&&d.append(b,a)});const e=d.toString();a.parentElement.remove(),this.nextOpenCondition(b,e,"update")}),o&&o.addEventListener("click",a=>{a.preventDefault(),a.target.classList.contains("nxt-header-note")||("header"==c.value||"footer"==c.value||"hooks"==c.value)&&(a.currentTarget.classList.contains("active")?(a.currentTarget.classList.remove("active"),"header"==c.value&&f?f.classList.remove("active"):"footer"==c.value&&g?g.classList.remove("active"):"hooks"==c.value&&h&&h.classList.remove("active"),p.forEach(a=>{a.classList.add("active")}),q.forEach(a=>{a.classList.remove("active")})):(a.currentTarget.classList.add("active"),"header"==c.value&&f?f.classList.add("active"):"footer"==c.value&&g?g.classList.add("active"):"hooks"==c.value&&h&&h.classList.add("active"),p.forEach(a=>{a.classList.remove("active")}),q.forEach(a=>{a.classList.contains("nxt-header-note")?"header"==c.value&&a.classList.add("active"):a.classList.add("active")})))}),jQuery("#nxt-hooks-footer-smart-bgcolor").wpColorPicker({change:function(a,b){b.color.toString()}}),jQuery(".nxt-footer-picker-icon").on("click",function(){jQuery("#nxt-hooks-footer-smart-bgcolor").wpColorPicker("open"),jQuery(".wp-color-result").trigger("click")}),c&&c.addEventListener("change",b=>{if(c.style="","section"==b.currentTarget.value){let b=a.querySelector(".temp-action-btn");b&&b.classList.add("nxt-hide");let c=a.querySelector(".nxt-temp-action");c&&c.insertAdjacentHTML("beforeend","<div class=\"nxt-action-btn-wrap\"><input type=\"hidden\" name=\"action\" value=\"nexter_ext_save_template\" id=\"nxt_section_action\" /><input type=\"hidden\" name=\"nonce\" value=\""+NexterConfig.hiddennonce+"\" /><button type=\"submit\" class=\"temp-create-btn\">Create</button></div>"),r.setAttribute("action",NexterConfig.adminPostUrl)}else{let b=document.querySelector(".nxt-action-btn-wrap");b&&b.remove();let c=a.querySelector(".temp-action-btn");c&&c.classList.remove("nxt-hide"),r.removeAttribute("action",NexterConfig.adminPostUrl)}if("header"!=b.currentTarget.value&&"footer"!=b.currentTarget.value&&"hooks"!=b.currentTarget.value)("header"==b.currentTarget.value&&f||"footer"==b.currentTarget.value&&g||"hooks"==b.currentTarget.value&&h)&&o.parentElement.classList.remove("visible");else if("header"==b.currentTarget.value&&f||"footer"==b.currentTarget.value&&g||"hooks"==b.currentTarget.value&&h?o.parentElement.classList.add("visible"):("header"==b.currentTarget.value&&null==f||"footer"==b.currentTarget.value&&null==g||"hooks"==b.currentTarget.value&&null==h)&&o.parentElement.classList.remove("visible"),"header"==b.currentTarget.value&&q){let a=!1;q.forEach((b,c)=>{0==c&&(a=!!b.classList.contains("active")),b.classList.contains("nxt-header-note")&&a&&b.classList.add("active")})}else q&&q.forEach(a=>{a.classList.contains("nxt-header-note")&&a.classList.remove("active")});f&&("header"==b.currentTarget.value&&o.classList.contains("active")?f.classList.add("active"):f.classList.remove("active")),g&&("footer"==b.currentTarget.value&&o.classList.contains("active")?g.classList.add("active"):g.classList.remove("active")),h&&("hooks"==b.currentTarget.value&&o.classList.contains("active")?h.classList.add("active"):h.classList.remove("active"))}),l&&l.addEventListener("change",a=>{"smart"==a.currentTarget.value?m.classList.add("visible"):m.classList.remove("visible")});let v=a.querySelector(".nxt-condition-include");if(v){let a=v.querySelector(".nxt-add-display-rule");this.includeExcludeRules(v,a,"include")}let w=a.querySelector(".nxt-condition-exclude");if(w){let a=w.querySelector(".nxt-exclude-display-rule");this.includeExcludeRules(w,a,"exclude")}let x=a.querySelector("#accordion-container");if(x){let c=this;jQuery(".nxt-single-archive-post").select2({dropdownCssClass:"nxt-builder-select"});let d=x.querySelectorAll(".accordion-item");var b=JSON.parse(JSON.stringify(NexterConfig));d&&d.forEach(a=>{c.hideSinArcDropdown(a,b)}),a.querySelector(".nxt-add-accordion").addEventListener("click",function(a){let d=x.querySelectorAll(".accordion-item"),e=a.currentTarget.getAttribute("data-type"),f=0;d&&d.forEach(a=>{let b=a.getAttribute("data-id");f=+b+1}),a.preventDefault();const g=new XMLHttpRequest;g.open("POST",nexter_admin_config.ajaxurl,!0),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded;"),g.onload=()=>{if(200<=g.status&&400>g.status){const d=JSON.parse(g.response);a.target.insertAdjacentHTML("beforebegin",d.data.content),jQuery(".nxt-single-archive-post").select2({dropdownCssClass:"nxt-builder-select"}),setTimeout(()=>{let a=x.querySelectorAll(".accordion-item");2<=a.length?a.forEach(a=>{let d=a.querySelector(".accordion-header");d&&d.classList.contains("hide-remove-btn")&&d.classList.remove("hide-remove-btn"),c.hideSinArcDropdown(a,b)}):a.forEach(a=>{let b=a.querySelector(".accordion-header");b&&b.classList.add("hide-remove-btn")})},10)}};let h="action=nexter_ext_repeater_custom_structure&nexter_nonce="+nexter_admin_config.ajax_nonce+"&nextId="+f+"&type="+e;g.send(h)}),x.addEventListener("click",function(a){if(a.target.classList.contains("remove-accordion")||a.target.classList.contains("remove-accordion-path")){a.preventDefault();const b=a.target.closest(".accordion-item");2<x.children.length&&b.remove(),setTimeout(()=>{let a=x.querySelectorAll(".accordion-item");2<=a.length?a.forEach(a=>{let b=a.querySelector(".accordion-header");b&&b.classList.contains("hide-remove-btn")&&b.classList.remove("hide-remove-btn")}):a.forEach(a=>{let b=a.querySelector(".accordion-header");b&&b.classList.add("hide-remove-btn")})},10)}})}jQuery(document).on("change",".nxt-singular-group-select",function(a){var b=a.currentTarget.closest(".accordion-item").querySelector(".nxt-single-archive-post"),c={action:"nxt_singular_archives_filters_ajax"};c.data="",c.rules=this.value;var d=JSON.parse(JSON.stringify(NexterConfig));c.data=JSON.stringify(d[c.rules]),null!=this.value&&"front_page"!=this.value?jQuery.ajax({type:"POST",url:nexter_admin_config.ajaxurl,data:c,beforeSend:function(){b.style.display="block",b.nextElementSibling.style.display="block"},success:function(a){var a=JSON.parse(a);if("undefined"!=a.response&&!0==a.response&&"undefined"!=a.results){for(var c=a.results;b.firstChild;)b.removeChild(b.firstChild);var d={id:"all",text:"All"},e=new Option(d.text,d.id,!0,!0);b.append(e),b.dispatchEvent(new Event("change")),c.forEach(function(a){var c=new Option(a.text,a.id,!1,!1);b.append(c),b.dispatchEvent(new Event("change"))})}else{for(var c={id:"all",text:"All"};b.firstChild;)b.removeChild(b.firstChild);var e=new Option(c.text,c.id,!0,!0);b.append(e),b.dispatchEvent(new Event("change"))}}}):(b.style.display="none",b.nextElementSibling.style.display="none")}),jQuery(document).on("change",".nxt-archive-group-select",function(a){var b=this.value,c=a.currentTarget.closest(".accordion-item").querySelector(".nxt-single-archive-post");c.style.display="block",c.nextElementSibling.style.display="block";var d={action:"nxt_singular_archives_filters_ajax",data:"",rules:b},e=JSON.parse(JSON.stringify(NexterConfig));d.data=JSON.stringify(e.nxt_archives[d.rules]),null!=b&&""!=e.nxt_archives[b].condition_type&&null!=e.nxt_archives[b].condition_type&&"yes"==e.nxt_archives[b].condition_type?jQuery.ajax({type:"POST",url:ajaxurl,data:d,beforeSend:function(){c.style.display="block",c.nextElementSibling.style.display="block"},success:function(a){var a=JSON.parse(a);if("undefined"!=a.response&&!0==a.response&&"undefined"!=a.results){var b=a.results;for(jQuery(c).select2("close");c.firstChild;)c.removeChild(c.firstChild);var d={id:"all",text:"All"},e=new Option(d.text,d.id,!0,!0);c.append(e),c.dispatchEvent(new Event("change")),b.forEach(function(a){var b=new Option(a.text,a.id,!1,!1);c.append(b),c.dispatchEvent(new Event("change"))})}else{var b={id:"all",text:"All"};for(jQuery(c).select2("close");c.firstChild;)c.removeChild(c.firstChild);var e=new Option(b.text,b.id,!0,!0);c.append(e),c.dispatchEvent(new Event("change"))}}}):(c.style.display="none",c.nextElementSibling.style.display="none")}),jQuery(document).on("change",".nxt-singular-preview-type-select",function(a){var b=a.currentTarget.closest(".nxt-pages-preview-wrap").querySelector(".nxt-singular-preview-id-select"),c={action:"nxt_singular_preview_type_ajax"};c.rules=this.value,null!=this.value&&"front_page"!=this.value&&jQuery.ajax({type:"POST",url:ajaxurl,data:c,success:function(a){var a=JSON.parse(a);if("undefined"!=a.response&&!0==a.response&&"undefined"!=a.results){for(var c=a.results;b.firstChild;)b.removeChild(b.firstChild);c.forEach(function(a){var c=new Option(a.text,a.id,!1,!1);b.append(c),b.dispatchEvent(new Event("change"))})}else{for(var c={id:"all",text:"All"};b.firstChild;)b.removeChild(b.firstChild);var d=new Option(c.text,c.id,!0,!0);b.append(d),b.dispatchEvent(new Event("change"))}}})}),jQuery(document).on("change",".nxt-archive-preview-type-select",function(a){var b=this.value,c=a.currentTarget.closest(".nxt-pages-preview-wrap").querySelector(".nxt-archive-preview-id-select"),d={action:"nxt_archive_preview_taxonomy_ajax"};d.data="",d.rules=b;var e=JSON.parse(JSON.stringify(NexterConfig));d.data=JSON.stringify(e.nxt_archives[d.rules]),null!=b&&""!=e.nxt_archives[b].condition_type&&null!=e.nxt_archives[b].condition_type&&"yes"==e.nxt_archives[b].condition_type&&jQuery.ajax({type:"POST",url:ajaxurl,data:d,success:function(a){var a=JSON.parse(a);if("undefined"!=a.response&&!0==a.response&&"undefined"!=a.results){for(var b=a.results;c.firstChild;)c.removeChild(c.firstChild);b.forEach(function(a){var b=new Option(a.text,a.id,!1,!1);c.append(b),c.dispatchEvent(new Event("change"))})}else{for(var b={id:"all",text:"All"};c.firstChild;)c.removeChild(c.firstChild);var d=new Option(b.text,b.id,!0,!0);c.append(d),c.dispatchEvent(new Event("change"))}}})}),i&&i.addEventListener("input",a=>{a.currentTarget.value?i.style="":i.style.borderColor="red"});let y=a.querySelector(".temp-action-btn");y&&y.addEventListener("click",b=>{b.preventDefault();const d=new FormData(r);let e=new URLSearchParams;if(c.value&&i.value){d.forEach((a,b)=>{const c=r.querySelector(`[name="${b}"]`),d="none"!==window.getComputedStyle(c.parentElement).display;"action"!==b&&d&&e.append(b,a)}),a.parentElement.remove();const b=e.toString();let f="";"header"==c.value||"footer"==c.value||"breadcrumb"==c.value||"hooks"==c.value?f="action=nexter_ext_sections_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&"+b+"&type=new":"singular"==c.value||"archives"==c.value||"page-404"==c.value?"page-404"==c.value?f="action=nexter_ext_pages_404_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&"+b+"&type=new":f="action=nexter_ext_pages_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&"+b+"&type=new":"section"==c.value&&(f="action=nexter_ext_sections_condition_popup&nexter_nonce="+nexter_admin_config.ajax_nonce+"&"+b+"&type=new"),this.nxtBuilderCommon(f,!0)}else c.value?c.style="":c.style.borderColor="red",i.value?i.style="":i.style.borderColor="red"})}}},c.send(b),a&&this.nxt_ext_close_pop(a.parentElement)}nxtShow(a){a&&(a.style.display="block")}nxtHide(a){a&&(a.style.display="none")}includeExcludeRules(a,b,c){function d(){var a=jQuery(b).val();e&&a&&a.includes("set-day")?e.classList.add("active"):e&&e.classList.remove("active"),f&&a&&a.includes("os")?f.classList.add("active"):f&&f.classList.remove("active"),g&&a&&a.includes("browser")?g.classList.add("active"):g&&g.classList.remove("active"),h&&a&&a.includes("login-status")?h.classList.add("active"):h&&h.classList.remove("active"),j&&a&&a.includes("particular-post")?j.classList.add("active"):j&&j.classList.remove("active"),i&&a&&a.includes("user-roles")?i.classList.add("active"):i&&i.classList.remove("active");var c=function(a){jQuery(a).select2({dropdownCssClass:"nxt-builder-select",ajax:{url:ajaxurl,dataType:"json",method:"post",delay:250,data:function(a){return{q:a.term,page:a.page,action:"nexter_get_particular_posts_query"}},processResults:function(a){return{results:a}},cache:!0},minimumInputLength:2,language:""})},d=document.getElementById("nxt-hooks-layout-specific");d&&c(d);var k=document.getElementById("nxt-hooks-layout-exclude-specific");k&&c(k)}let e=a.querySelector(".nxt-set-day-wrap"),f=a.querySelector(".nxt-layout-os-wrap"),g=a.querySelector(".nxt-layout-browser-wrap"),h=a.querySelector(".nxt-layout-login-status-wrap"),i=a.querySelector(".nxt-layout-login-user-roles-wrap"),j=a.querySelector(".nxt-layout-specific-post-wrap"),k="include"==c?"show":"hide";jQuery(b).select2({dropdownCssClass:"nxt-builder-select",value:"",placeholder:"Select locations where you want to "+k+" your template.",allowClear:!0}),jQuery(".nxt-set-day").select2({dropdownCssClass:"nxt-builder-select",value:"",placeholder:"",allowClear:!0}),jQuery(".nxt-layout-os").select2({dropdownCssClass:"nxt-builder-select",value:"",placeholder:"",allowClear:!0}),jQuery(".nxt-layout-browser").select2({dropdownCssClass:"nxt-builder-select",value:"",placeholder:"",allowClear:!0}),jQuery(".nxt-layout-login-status").select2({dropdownCssClass:"nxt-builder-select",value:"",placeholder:"",allowClear:!0}),jQuery(".nxt-layout-user-roles").select2({dropdownCssClass:"nxt-builder-select",value:"",placeholder:"",allowClear:!0}),d(),jQuery(b).on("change",d)}hideSinArcDropdown(a,b){let c=a.querySelector(".nxt-archive-group-select");if(c){let d=a.querySelector(".nxt-single-archive-post"),e=c.value;e!=null&&""!=b.nxt_archives[e].condition_type&&b.nxt_archives[e].condition_type!=null&&"yes"==b.nxt_archives[e].condition_type||(d.style.display="none",d.nextElementSibling.style.display="none")}let d=a.querySelector(".nxt-singular-group-select");if(d){let b=a.querySelector(".nxt-single-archive-post"),c=d.value;c!=null&&"front_page"==c&&(b.style.display="none",b.nextElementSibling.style.display="none")}}closePopupAction(a){let b=window.nxtBuilderOldData,c=a.querySelector(".nxt-bul-temp"),d=a.querySelector(".nxt-close-warning-popup"),e=a.querySelector(".nxt-ext-pop-inner"),f=e.querySelector("form"),g=new FormData(f),h=new URLSearchParams;g.forEach((a,b)=>{let c=f.querySelector(`[name="${b}"]`);const d="none"!==window.getComputedStyle(c.parentElement).display;"action"!==b&&d&&h.append(b,a)});let i=h.toString();if(b==i)a.remove();else if(d){let b=d.querySelector(".popup-leave-btn");b&&("block"==d.style.display?(d.style.display="none",c.style.display="block"):(c.style.display="none",d.style.display="block"),b&&b.addEventListener("click",()=>{a.remove()}))}}}new NexterBuilder,window.NexterBuilder=NexterBuilder;